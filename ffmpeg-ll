#! /bin/bash

# This file will take a clip from a movie and perform certain operations on it. 


# VIDEO 1 Operations
	# Trim: 8:00 to 11:00
	# Sync/trim the audio for that section of film
	#
	# Display Frequency spectrum underneath
	# Display Power Spectrum Underneath
	# Display Something to the side of the video and the bottom will be colored green.
	# Histogram

# VIDEO2 Operations
	# Trim: 20:11 to 21:46
	# OVERLAY to mirror Top half onto bottom half
	# Overlay to Put bottom half on top half and top half on bottom half
	# Blur the video
	# ROTATE video in sinusoidal manner
	# 
	
# VIDEO3 Operations
	# Trim: 22:50 to 23:57
	# Exponential Saturation Fade-Out with HUE
	# Full Color
	# Red Channel Only: COLORCHANNELMIXER
	# Green Channel Only
	# Blue Channel Only
	# Full Color
	# CROP but PAD with purple
	# Change framerate.
	# Chorus Delay on Audio
	# Play with geq, hflip, 
# https://trac.ffmpeg.org/wiki/FancyFilteringExamples
# https://trac.ffmpeg.org/wiki/FilteringGuide

# FINAL OPERATIONS
	# Add subtitles to the entire video detailing which settings I have used at each effecrt change. SUBTITLES
	# TODO: Make a .srt file.

###########################################################################
# EFFECTS AND THEIR TIMES





## DECLARE VARS
TEST="/Users/xavier/Downloads/mov/A.Beautiful.Mind.2001.1080p/A.Beautiful.Mind.2001.1080p.BluRay.x264.GSFTX.mp4"

# 00:08:22 to 00:08:49
T1=502  
T2=511
T3=520
T4=529
# 00:02:00 to 00:02:12
T5=120
T6=132
# 00:21:03 to 00:21:25
T7=1263
T8=1274
T9=1286

SCALE=1/1 # 2/3, 
SF=1.0 # 1.5,
T=35 #  Period for video ROTATE

# ERATTA: CHROMAKEY FILTER IN 37.10 of ffmpeg is actually COLORKEY.
ffmpeg -i $TEST \
	-f lavfi -i color=black@0.1:s=1920x520 \
	-async 1 \
	-r 35.97 \
	-filter_complex \
		"
		[0:v]trim=$T1:$T2, setpts=$SCALE*(PTS-STARTPTS)[v12]; \
		[0:a]atrim=$T1:$T2, asetpts=$SCALE*(PTS-STARTPTS)[a12]; \
		[0:a]atrim=$T1:$T2, asetpts=$SCALE*(PTS-STARTPTS, \
			showfreqs=size="1920x1040":mode=line, \
			scale=w=iw:h=0.5*ih[vtemp00]; \
		[1:v]trim=$T1:$T2, setpts=$SCALE*(PTS-STARTPTS), \
			 colorkey=i0x70de77:1.0:0.2[blk]
		 [blk][vtemp00]overlay=x=main_w-overlay_w:y=main_h-overlay_h:enable='between(t,0,179)'[vtemp01]; \
		 [v12][vtemp01]overlay=x=main_w-overlay_w:y=main_h-overlay_h, rotate=2*PI*t/$T[v0]; \
		\	
		[0:v]trim=$T2:$T3, setpts=$SCALE*(PTS-STARTPTS)[v23]; \
		[0:a]atrim=$T2:$T3, asetpts=$SCALE*(PTS-STARTPTS)[a23]; \
		[0:a]atrim=$T2:$T3, asetpts=$SCALE*(PTS-STARTPTS), \
			showfreqs=size="1920x1040":mode=line, \
			scale=w=iw:h=0.5*ih[vtemp10]; \
		[1:v]trim=$T2:$T3, setpts=$SCALE*(PTS-STARTPTS), \
			 colorkey=i0x70de77:1.0:0.2[blue];
		 [blue][vtemp10]overlay=x=main_w-overlay_w:y=main_h-overlay_h:enable='between(t,0,179)'[vtemp11]; \
		 [v23][vtemp11]overlay=x=main_w-overlay_w:y=main_h-overlay_h, rotate=2*PI*t/$T[v1]; \
		\
		[0:v]trim=$T3:$T4, setpts=$SCALE*(PTS-STARTPTS)[v34]; \
		[0:a]atrim=$T3:$T4, asetpts=$SCALE*(PTS-STARTPTS)[a34]; \
		[0:a]atrim=$T3:$T4, asetpts=$SCALE*(PTS-STARTPTS), \
			showfreqs=size="1920x1040":mode=line, \
			scale=w=iw:h=0.5*ih[vtemp20]; \
		[1:v]trim=$T3:$T4, setpts=$SCALE*(PTS-STARTPTS), \
			 colorkey=i0x70de77:1.0:0.2[red];
		 [red][vtemp20]overlay=x=main_w-overlay_w:y=main_h-overlay_h:enable='between(t,0,179)'[vtemp21]; \
		 [v34][vtemp21]overlay=x=main_w-overlay_w:y=main_h-overlay_h, rotate=2*PI*t/$T[v2]; \
		\
		\
		[0:v]trim=$T5:$T6, setpts=$SCALE*(PTS-STARTPTS)[v56]; \
		[0:a]atrim=$T5:$T6, asetpts=$SCALE*(PTS-STARTPTS)[a56]; \
		\
		\
		[0:v]trim=$T7:$T8, setpts=(PTS-STARTPTS), \
			colorchannelmixer=.3:.4:.3:0:.3:.4:.3:0:.3:.4:.3, \
			rotate=2*PI*t/$T[v4]; \
		[0:a]atrim=$T7:$T8, asetpts=$SCALE*(PTS-STARTPTS)[a78]; \
			chorus=0.5:0.9:50|60|40:0.4|0.32|0.3:0.25|0.4|0.3:2|2.3|1.3; \
		\
		\
		[0:v]trim=$T8:$T9, setpts=$SCALE*(PTS-STARTPTS), 
			hue="H=2*PI*t: s=sin(2*PI*t)+1"[v5]; \
		[0:a]atrim=$T8:$T9,  asetpts=(PTS-STARTPTS)[a89]; \
		\
		[v0][a12][v1][a23][v2][a34][v3][a56][v4][a78][v5][a89]concat=n=6:v=1:a=1[out]
		" 
	-b:a 192k \
	-strict -2 \
	-y \
	-map "[out]" \
	output.mkv



## OLD CODE BELOW
[0:v]trim=$T1:$T2, setpts=$SCALE*(PTS-STARTPTS)[v0]; \
		 [0:a]atrim=$T1:$T2, asetpts=$SCALE*(PTS-STARTPTS), \
			showfreqs=size="1920x1040":mode=line, \
			scale=w=iw:h=0.5*ih[v0-a]; \
		\
		\
		 [0:a]atrim=$T1:$T2, atempo=$SF, asetpts=(PTS-STARTPTS), chorus=0.5:0.9:50|60|40:0.4|0.32|0.3:0.25|0.4|0.3:2|2.3|1.3[a0]; \
		 [0:v]trim=$T3:$T4, setpts=$SCALE*(PTS-STARTPTS), hue="H=2*PI*t:s=3"[v1]; \
		 [0:a]atrim=$T3:$T4, atempo=$SF, asetpts=PTS-STARTPTS[a1]; \
		 [0:v]trim=$T5:$T6, setpts=(PTS-STARTPTS), \
			colorchannelmixer=.3:.4:.3:0:.3:.4:.3:0:.3:.4:.3[v2]; \
		 [0:a]atrim=$T5:$T6,  asetpts=(PTS-STARTPTS)[a2]; \
		[1:v]trim=$T1:$T2, setpts=$SCALE*(PTS-STARTPTS), colorkey=0x70de77:1.0:0.2[blk];
		[1:v]trim=$T1:$T2, setpts=$SCALE*(PTS-STARTPTS), colorkey=0x70de77:1.0:0.2[blk];
		 [blk][v0-a]overlay=x=main_w-overlay_w:y=main_h-overlay_h:enable='between(t,0,179)'[v0-1]; \
		 [v0][v0-1]overlay=x=main_w-overlay_w:y=main_h-overlay_h, rotate=2*PI*t/$T[v0-over]; \
		 [v0-over][a0][v1][a1][v2][a2]concat=n=3:v=1:a=1[out]
		" \
	-b:a 192k \
	-strict -2 \
	-y \
	-map "[out]" \
	output.mkv




